import numpy as np
import scipy.special
from bokeh.layouts import gridplot
from bokeh.plotting import figure, show
from bokeh.resources import CDN
from bokeh.io import output_notebook
output_notebook(resources=CDN)
from bokeh.models import Range1d

buckets, earliest, latest, gran = ray.global_state.time_series()
desired_range = (min(buckets), max(buckets)+10)
distr = []
for x in range(len(buckets)):
    for y in range(buckets[x]):
        distr.append(x)

p = figure(title="Task Time Series",tools=["save", "hover", "wheel_zoom", "box_zoom", "pan"],
            background_fill_color="#FFFFFF", y_range = desired_range, x_range = (0, latest - earliest))

hist, bin_edges = np.histogram(distr, bins = range(len(buckets)))

p.quad(top=hist, bottom=0, left=bin_edges[:-1], right=bin_edges[1:],
        fill_color="#B3B3B3", line_color="#033649")

p.xaxis.axis_label = 'Time in seconds'
p.yaxis.axis_label = 'Number of concurrent tasks'

show(gridplot(p, ncols=1, plot_width=500, plot_height=500, toolbar_location="below"))